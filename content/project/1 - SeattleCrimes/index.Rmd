---
title: "Project 1 - Seattle Crime"
date: '2021-07-01T21:42:38-07:00'
tags:
- Analytics
- Storytelling
comments: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

## Context

Year 2020 was full of surprises, especially in Seattle. The historical cancellation of the New Year's fireworks seemed to be the premonition of the year to come. Grasped with the pandemic and social unrest, headlines of frequent crimes along with the police defunding movement, it makes one question if crime is actually on the rise in Seattle. This became the inspiration for this project.

### How I did this

This notebook is an in-depth analysis of Seattle Crimes using:
- Seattle Police Department (SPD) Crimes Data downloaded from [Seattle Open Data](https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5) on June 30th 2021. 

- Population estimate for Seattle City from the US Census Bureau for [2000-2010](https://www.census.gov/data/datasets/time-series/demo/popest/intercensal-2000-2010-cities-and-towns.html) and [2010-2019](https://www.census.gov/data/datasets/time-series/demo/popest/2010s-total-cities-and-towns.html) downloaded on June 30th 2021.
  + Population estimates for 2020 were copied from 2019 as no new data is available yet.


```{r, echo=FALSE,message=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(readxl)
library(reshape2)
library(knitr)
library(gridExtra)
```

```{r, echo=FALSE, message=FALSE}
# load csv file.
crimes = read.csv(file = "SEACrimes_2008_Present.csv")
census00.10 = read.csv(file = "pop2000-2010.csv")
census10.19 = read_excel("F:\\Lily\\Documents\\Portfolio\\website\\content\\project\\1 - SeattleCrimes\\pop2010-2019.xlsx", skip = 3)
names(census10.19)[names(census10.19) == "...1"] = "City.Name"
```

```{r, echo=FALSE}
# Format date and time for later data extraction.
crimes$Report.DateTime = as.POSIXct(as.character(crimes$Report.DateTime), format =  "%m/%d/%Y %H:%M")
crimes$Report.Date = as.Date(crimes$Report.DateTime)
crimes = separate(crimes, Report.Date, c("Report.Year", "Report.Month", "Report.Day"), sep = "[-]")

crimes$Report.Time = format(crimes$Report.DateTime, "%T")
crimes = separate(crimes, Report.Time, c("Report.Hour", "Report.Min", "Report.Sec"), sep = "[:]")
```


```{r, echo=FALSE}
# Remove 2021 data, only taking complete year reports
crimes.pre2021 = filter(crimes, Report.Year <=2020)

crimes.pre2021.year = crimes.pre2021 %>% 
  group_by(Report.Year) %>% 
  summarise(count=n()) %>% 
  mutate(percent = count/sum(count))
```

#### Crime rate per year:

If we examine the occurrence of crimes each year (2008-2020, 2021 removed due to partial data) as a fraction of total crimes, we get the following:

```{r, echo=FALSE}
# Create new theme for plot
plot.theme1 = theme(
  plot.title = element_text(size = 10, hjust = 0.5),
  axis.title.x = element_text(size = 10),
  axis.text.x = element_text(angle=45, hjust=1, size = 8),
  axis.title.y = element_text(size = 10),
  axis.text.y = element_text(size = 8))
```


```{r, echo=FALSE}
# extract pop estimate for years 2008 and 2009
census00.10.melt = melt(census00.10, id = c(1:7))

pop08.09 = unique((filter(census00.10.melt, (NAME == "Seattle city" & (variable == "POPESTIMATE2008" | variable == "POPESTIMATE2009"))))$value)

# loop to add pop values to new vector for later column addition
pop.by.year = vector("integer", 13L)
for (i in 1:2)
  pop.by.year[i] = pop08.09[i]

# extract pop estimate for years 2010 to 2020.
census10.19.melt = melt(census10.19, id = c(1:3))

pop10.19 = filter(census10.19.melt, City.Name == "Seattle city, Washington")$value

# loop to add pop values to new vector for later column addition
for (i in 3:12)
  pop.by.year[i] = pop10.19[i-2]

# add 2019 pop value for 2020 as new data not available yet.
pop.by.year[13] = pop10.19[10]

# add pop vector to year crime count table to compute crime rate per 100000 pop
crimes.pre2021.year["population"] = pop.by.year

# compute total crime rate per 100000 pop
crimes.pre2021.year = mutate(crimes.pre2021.year,
                             crime.rate = (count/population)*100000)

# plot of fraction of crime per year
plot.fraction = ggplot(data = crimes.pre2021.year, mapping=aes(x=Report.Year, y=percent)) + 
  geom_point() +
  geom_line(group = 1) +
  labs(x = "Year", y = "Fraction of crimes committed", title = "Percentage of crimes committed each year") +
  plot.theme1

# plot of crime per pop per year
plot.rate = ggplot(data = crimes.pre2021.year, mapping=aes(x=Report.Year, y=crime.rate)) + 
  geom_point() +
  geom_line(group = 1) +
  labs(x = "Year", y = "Crime rate per 100,000 pop", title = "Crime rate per 100,000 population per year") +
  plot.theme1

grid.arrange(plot.fraction, plot.rate, nrow=1, ncol=2)

```

A simple plot (*on the left*) of crime counts per year over total crimes of all years (2021 removed due to partial data) shows that crimes drastically decreased in the years of 2011-2012, then steadily increased with the highest counts in 2020. There is a small dip in that can be noted in 2019. Therefore, it seems at first glance that after 2012, crimes increased in Seattle.

However, a more telling plot of crime rate per 100,000 population (*on the right*) can help us examine our assumptions further. In fact, we can see that crime rate is actually very high in 2008 and 2009, and steadily decreased to the lowest level in 2012. Surprisingly, the small dip observed on the previous plot in 2019 revealed a more significant decline in crime rate per population. Last thing to note is that there is a increase of crime in 2020 that can be observed in both plots.

Thus, let's examine the differences between year 2019 and 2020.

```{r, fig.align="center", fig.height = 6, fig.width = 8, echo=FALSE, message=FALSE}

year.pre2021 = crimes.pre2021 %>% 
  group_by(Offense, Report.Year) %>% 
  summarise(count=n())

# select only year 2019 and 2020
year.19.20 = filter(year.pre2021, Report.Year ==2020 | Report.Year ==2019)

# find out top 5 crimes for both years
year.19.20.merge = merge(year.19.20, crimes.pre2021.year, by = "Report.Year", all.x = T)

year.19.20.merge = mutate(year.19.20.merge,
                          crime.rate.ind = (count.x/population)*100000)

year.19.20.order = year.19.20.merge[order(-year.19.20.merge$crime.rate.ind, year.19.20.merge$Offense),]

# Compute top 10 type of offenses and store in a vector
x = unique(year.19.20.order$Offense)
y = x[1:10]

#subset top 10 offenses for 2019 and 2020
year.19.20.subset = year.19.20.merge[year.19.20.merge$Offense %in% y,]

ggplot(year.19.20.subset, aes(fill=Report.Year, y=crime.rate.ind, x=Offense)) +
  geom_bar(position="dodge", stat="identity") +
  labs(x = "Type of Offense", y = "Crime rate per 100,000 population", title = "Crime rate of top 10 Offenses in 2019 and 2020") + 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x=element_text(angle=45,hjust=1))

```

#### 2019 vs 2020

##### Offense Types:

* **Identity Theft** is drastically high in 2020. Could the pandemic be a fertile ground for such activities given the new shift of work from home, unemployment benefits and online shopping? Coincidentally, this finding correlates with multiple reports which presents similar phenomenon in other communities throughout the country, such as [Florida](https://www.aarp.org/money/scams-fraud/info-2021/ftc-fraud-report-identity-theft-pandemic.html) or [California](https://sacramento.cbslocal.com/2020/09/15/edd-putting-people-risk-identity-theft/).
+ It should also be noted that the Seattle identity theft rate of **1273/100,000** is almost double than the Washington state rate of [**712/100,000**](https://www.iii.org/fact-statistic/facts-statistics-identity-theft-and-cybercrime)!

* **Theft from Motor Vehicle** decreased from 2019. One could guess that remote working and unemployment resulted in less vehicles parked in the streets during work hours.

* **Burglary/Breaking & Entering** increased in 2020. At first it may be counter-intuitive as one assumes people are at home all the time. It leads to the following question, are the location residences or commercial? Maybe commercial properties that are vacated during the pandemic became a prime target?

Let's check this hypothesis before we move on.

```{r, echo=F, message = FALSE}
crimes.2020 = filter(crimes, Report.Year == 2020)

# filter offense to only burglary and remove address where the value is empty
crimes.2020.burglary = filter(crimes.2020, Offense == "Burglary/Breaking & Entering", X100.Block.Address != "")

crimes.2020.burglary.address = crimes.2020.burglary %>% 
  group_by(X100.Block.Address) %>% 
  summarise(count=n())

crimes.2020.burglary.address = crimes.2020.burglary.address[order(-crimes.2020.burglary.address$count),]

# take the top 5 addresses
crimes.2020.burglary.address.top = head(crimes.2020.burglary.address, 5)
rownames(crimes.2020.burglary.address.top) = c()

# Display data frame in a table.
kable(crimes.2020.burglary.address.top, caption = "Top 5 X100 Block Address the highest number of Burglary/Breaking.", col.names = c("Block Address", "Total Count"))
```
* 12XX BLOCK OF HARRISON ST: in a residential area with many apartment buildings. Many of the ground floors of those buildings are for commercial use (restaurants, entertainments...)
* 14XX BLOCK OF 2ND AVE: a few condo buildings and facing a high school.
* 5XX BLOCK OF NE NORTHGATE WAY: in the center of a commercial district with many storefronts.
* 8XX BLOCK OF NE 67TH ST: a few apartment buildings with an empty lot in construction.
* 5XX BLOCK OF BROADWAY E: busy commercial district with many storefronts.

From above observations, we cannot fully support our hypothesis. Although some addresses block are clearly commercial, others are more difficult to distinguish. We can only say that part of the breaking activities are targeted towards commercial establishments. However, it does not mean that it is not the same trend in the other years.


Let's then examine those crimes in the year 2020, which remember, was the year with the highest crime occurrences.
First, do the crimes differ in terms of hour of the day?

```{r, fig.align="center", fig.height = 8, fig.width = 8, echo=FALSE, message=FALSE}

hour.2020 = crimes.2020 %>% 
  group_by(Report.Hour) %>% 
  summarise(count=n()) %>% 
  mutate(percent = count/sum(count))

hour.2020.offense = crimes.2020 %>% 
  group_by(Offense, Report.Hour) %>% 
  summarise(count=n()) %>% 
  mutate(percent = count/sum(count))

ggplot(data = hour.2020.offense, mapping=aes(x=Report.Hour, y=percent)) + 
  geom_point(size=0.5) + geom_line(color = "blue", group =1) + facet_wrap("Offense", ncol = 2) + 
  geom_line(data = hour.2020, mapping=aes(x=Report.Hour, y=percent), color = "grey", group=1) +
  labs(x = "Hour", y = "Fraction of crimes committed", title = "Percentage of crimes committed each hour by offense type") + 
  theme(plot.title = element_text(hjust = 0.5)) + 
   scale_x_discrete(breaks = c("00", "04", "08", "12", "16", "20", "24"), labels = c("0", "4", "8", "12", "16", "20", "24"))
```

Compared to the overall crime occurrence trend line (in gray), a few observations stand out:

- *Identity theft* is very high during working hours and remains after 16:00.
  + It could be that only during wake hours people realized that they experienced identity theft.
  + It could be that this kind of crime do not require immediate attention and could be deferred for reporting during working hours.
  
- *Simple Assault*