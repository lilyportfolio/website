---
title: "Project 1 - Seattle Crime"
date: '2021-07-01T21:42:38-07:00'
tags:
- Analytics
- Storytelling
comments: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

**Context**

Year 2020 was full of surprises, especially in Seattle. The historical cancellation of the New Year's fireworks seemed to be the premonition of the year to come. Grasped with the pandemic and social unrest, headlines of frequent crimes along with the police defunding movement, it makes one question if crime is actually on the rise in Seattle. This became the inspiration for this project.

*How I did this*
This notebook is an in-depth analysis of Seattle Crimes using:
- Seattle Police Department (SPD) Crimes Data downloaded from [Seattle Open Data](https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5) on June 30th 2021. 
- Population estimate for Seattle City from the US Census Bureau for [2000-2010](https://www.census.gov/data/datasets/time-series/demo/popest/intercensal-2000-2010-cities-and-towns.html) and [2010-2019](https://www.census.gov/data/datasets/time-series/demo/popest/2010s-total-cities-and-towns.html) downloaded on June 30th 2021.
  + Population estimates for 2020 were copied from 2019 as no new data is available yet.


```{r, echo=FALSE,message=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(readxl)
library(reshape2)
```

```{r, echo=FALSE, message=FALSE}
# load csv file.
crimes = read.csv(file = "SEACrimes_2008_Present.csv")
census00.10 = read.csv(file = "pop2000-2010.csv")
census10.19 = read_excel("F:\\Lily\\Documents\\Portfolio\\website\\content\\project\\1 - SeattleCrimes\\pop2010-2019.xlsx", skip = 3)
names(census10.19)[names(census10.19) == "...1"] = "City.Name"
```

```{r, echo=FALSE}
# Format date and time for later data extraction.
crimes$Report.DateTime = as.POSIXct(as.character(crimes$Report.DateTime), format =  "%m/%d/%Y %H:%M")
crimes$Report.Date = as.Date(crimes$Report.DateTime)
crimes = separate(crimes, Report.Date, c("Report.Year", "Report.Month", "Report.Day"), sep = "[-]")

crimes$Report.Time = format(crimes$Report.DateTime, "%T")
crimes = separate(crimes, Report.Time, c("Report.Hour", "Report.Min", "Report.Sec"), sep = "[:]")
```

If we examine the occurrence of crimes each year (2008-2020, 2021 removed due to partial data) as a fraction of total crimes, we get the following plot:

```{r, echo=FALSE}
# Remove 2021 data, only taking complete year reports
crimes.pre2021 = filter(crimes, Report.Year <=2020)

crimes.pre2021.year = crimes.pre2021 %>% 
  group_by(Report.Year) %>% 
  summarise(count=n()) %>% 
  mutate(percent = count/sum(count))

plot.percent = ggplot(data = crimes.pre2021.year, mapping=aes(x=Report.Year, y=percent)) + 
  geom_point() +
  geom_line(group = 1) +
  labs(x = "Year", y = "Fraction of crimes committed", title = "Percentage of crimes committed each year") +
  theme(plot.title = element_text(hjust = 0.5))
```

Above plot shows that crime rates in Seattle decreased in the year *2011-2012*, then steadily increases starting in 2013, with the highest rate in *2020*. That could be interesting. Let's compare these two years in terms of type of Offenses to see if we can detect any differences.

```{r, echo=FALSE}
# extract pop estimate for years 2008 and 2009
census00.10.melt = melt(census00.10, id = c(1:7))

pop08.09 = unique((filter(census00.10.melt, (NAME == "Seattle city" & (variable == "POPESTIMATE2008" | variable == "POPESTIMATE2009"))))$value)

# loop to add pop values to new vector for later column addition
pop.by.year = vector("integer", 13L)
for (i in 1:2)
  pop.by.year[i] = pop08.09[i]

# extract pop estimate for years 2010 to 2020.
census10.19.melt = melt(census10.19, id = c(1:3))

pop10.19 = filter(census10.19.melt, City.Name == "Seattle city, Washington")$value

# loop to add pop values to new vector for later column addition
for (i in 3:12)
  pop.by.year[i] = pop10.19[i-2]

# add 2019 pop value for 2020 as new data not available yet.
pop.by.year[13] = pop10.19[10]

# add pop vector to year crime count table to compute crime rate per 100000 pop
crimes.pre2021.year["population"] = pop.by.year

# compute total crime rate per 100000 pop
crimes.pre2021.year = mutate(crimes.pre2021.year,
                             crime.rate = (count/population)*100000)

plot.rate = ggplot(data = crimes.pre2021.year, mapping=aes(x=Report.Year, y=crime.rate)) + 
  geom_point() +
  geom_line(group = 1) +
  labs(x = "Year", y = "Crime rate per 100,000 pop", title = "Crime rate per 100,000 population per year") +
  theme(plot.title = element_text(hjust = 0.5))

par(mfrow=c(1,2))
plot.percent
plot.rate
```



```{r, fig.align="center", fig.height = 8, fig.width = 8, echo=FALSE, message=FALSE}

year.pre2021 = crimes.pre2021 %>% 
  group_by(Offense, Report.Year) %>% 
  summarise(count=n())
year.pre2021= mutate(year.pre2021,
                     percent = count/sum(year.pre2021$count))

# Create a reference data frame with all crimes in each year for later comparison.
year.no.facet = subset(year.pre2021, select = c("percent", "Offense"))

year.12.20 = filter(year.pre2021, Report.Year ==2020 | Report.Year ==2012)

# Create plot showing the percentage of crimes committed in 2012 and 2020 respective to all crimes in the same year
ggplot(data = year.12.20, mapping=aes(x = percent, y = Offense)) + 
  geom_point(data = year.no.facet, color="grey", size = 1.5) +
  geom_point(size = 1.0) + facet_wrap(~Report.Year) +
  labs(x = "Fraction of crimes committed", y = "Crimes", title = "Fraction of crimes committed in 2012 and 2020 by offense type") + theme(plot.title = element_text(hjust = 0))

```

Interestingly (or not), other than **Identity Theft** which occurred at at the highest rate in 2020 compared to all previous years, the other most occurring crimes (in terms of fraction compared to total crimes in the year) seem to happen at a fairly similar rate. Those crimes include:

- Theft from Motor Vehicle
- Simple Assault
- Shoplifting
- Motor Vehicle Theft
- Destruction/Damage/Vandalism of Property
- Burglary/Breaking & Entering
- All Other Larceny
- Aggravated Assault

Let's then examine those crimes in the year 2020, which remember, was the year with the highest crime occurrences.
First, do the crimes differ in terms of hour of the day?

```{r, fig.align="center", fig.height = 8, fig.width = 8, echo=FALSE, message=FALSE}

crimes.2020 = filter(crimes, Report.Year == 2020)

crimes.2020.offense = filter(crimes.2020, Offense == "Theft from Motor Vehicle" | Offense == "Simple Assault" | Offense == "Motor Vehicle Theft" | Offense == "Identity Theft" | Offense == "Destruction/Damage/Vandalism of Property" | Offense == "Burglary/Breaking & Entering" | Offense == "All Other Larceny")

hour.2020 = crimes.2020.offense %>% 
  group_by(Report.Hour) %>% 
  summarise(count=n()) %>% 
  mutate(percent = count/sum(count))

hour.2020.offense = crimes.2020.offense %>% 
  group_by(Offense, Report.Hour) %>% 
  summarise(count=n()) %>% 
  mutate(percent = count/sum(count))

ggplot(data = hour.2020.offense, mapping=aes(x=Report.Hour, y=percent)) + 
  geom_point(size=0.5) + geom_line(color = "blue", group =1) + facet_wrap("Offense", ncol = 2) + 
  geom_line(data = hour.2020, mapping=aes(x=Report.Hour, y=percent), color = "grey", group=1) +
  labs(x = "Hour", y = "Fraction of crimes committed", title = "Percentage of crimes committed each hour by offense type") + 
  theme(plot.title = element_text(hjust = 0.5)) + 
   scale_x_discrete(breaks = c("00", "04", "08", "12", "16", "20", "24"), labels = c("0", "4", "8", "12", "16", "20", "24"))
```

Compared to the overall crime occurrence trend line (in gray), a few observations stand out:

- *Identity theft* is very high during working hours and remains after 16:00.
  + It could be that only during wake hours people realized that they experienced identity theft.
  + It could be that this kind of crime do not require immediate attention and could be deferred for reporting during working hours.
  
- *Simple Assault*